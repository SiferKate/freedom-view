import{r as h,j as e}from"./index-6a72a591.js";import{B as f,S as D,P as E}from"./page-6af04b3b.js";import{u as j}from"./use-app-params-92a9fe39.js";import{f as $,g as G,h as U,u as b,d as k,i as L,v as M,j as V,P as H}from"./index-20740df3.js";import{S as N,U as O,M as F}from"./message-list-bede7733.js";import{c as P,I as w}from"./chunk-DEQZ7DVA-7a0def0c.js";import{H as I}from"./chunk-O7JH6DZT-d044f86c.js";function Q(s,a={}){const{ssr:o=!0,fallback:n}=a,{getWindow:r}=$(),t=Array.isArray(s)?s:[s];let i=Array.isArray(n)?n:[n];i=i.filter(c=>c!=null);const[l,u]=h.useState(()=>t.map((c,p)=>({media:c,matches:o?!!i[p]:r().matchMedia(c).matches})));return h.useEffect(()=>{const c=r();u(t.map(d=>({media:d,matches:c.matchMedia(d).matches})));const p=t.map(d=>c.matchMedia(d)),m=d=>{u(v=>v.slice().map(g=>g.media===d.media?{...g,matches:d.matches}:g))};return p.forEach(d=>{typeof d.addListener=="function"?d.addListener(m):d.addEventListener("change",m)}),()=>{p.forEach(d=>{typeof d.removeListener=="function"?d.removeListener(m):d.removeEventListener("change",m)})}},[r]),l.map(c=>c.matches)}function W(s){const{breakpoint:a,hide:o,children:n,ssr:r}=s,[t]=Q(a,{ssr:r});return(o?!t:t)?n:null}var y=(s,a)=>{var o,n;return(n=(o=s==null?void 0:s.breakpoints)==null?void 0:o[a])!=null?n:a};function Z(s){const{breakpoint:a="",below:o,above:n}=s,r=G(),t=y(r,o),i=y(r,n);let l=a;return t?l=`(max-width: ${t})`:i&&(l=`(min-width: ${i})`),l}function x(s){const{children:a,ssr:o}=s,n=Z(s);return e.jsx(W,{breakpoint:n,ssr:o,children:a})}x.displayName="Show";const R=()=>{const[s,a]=h.useState(),[o,n]=h.useState(null),r=h.useMemo(()=>U(s),[s]),t=h.useMemo(()=>r.filter(({fromId:i})=>!o||i.toString()===o),[r,o]);return{setMessages:a,photos:t,filterByUserId:o,setFilterByUserId:n,photosCount:r.length}},S=({onClick:s,pressed:a,photosCount:o,loading:n})=>e.jsxs(f,{colorScheme:"blue",variant:a?"solid":"outline",onClick:s,isDisabled:!a&&o<1,isLoading:n,loadingText:"Gallery",spinnerPlacement:"end",children:["Gallery (",o,")"]});var T=P({displayName:"ArrowLeftIcon",path:e.jsxs("g",{fill:"currentColor",children:[e.jsx("path",{d:"M10.416,12a2.643,2.643,0,0,1,.775-1.875L20.732.584a1.768,1.768,0,0,1,2.5,2.5l-8.739,8.739a.25.25,0,0,0,0,.354l8.739,8.739a1.768,1.768,0,0,1-2.5,2.5l-9.541-9.541A2.643,2.643,0,0,1,10.416,12Z"}),e.jsx("path",{d:"M.25,12a2.643,2.643,0,0,1,.775-1.875L10.566.584a1.768,1.768,0,0,1,2.5,2.5L4.327,11.823a.25.25,0,0,0,0,.354l8.739,8.739a1.768,1.768,0,0,1-2.5,2.5L1.025,13.875A2.643,2.643,0,0,1,.25,12Z"})]})}),_=P({displayName:"ArrowRightIcon",path:e.jsxs("g",{fill:"currentColor",children:[e.jsx("path",{d:"M13.584,12a2.643,2.643,0,0,1-.775,1.875L3.268,23.416a1.768,1.768,0,0,1-2.5-2.5l8.739-8.739a.25.25,0,0,0,0-.354L.768,3.084a1.768,1.768,0,0,1,2.5-2.5l9.541,9.541A2.643,2.643,0,0,1,13.584,12Z"}),e.jsx("path",{d:"M23.75,12a2.643,2.643,0,0,1-.775,1.875l-9.541,9.541a1.768,1.768,0,0,1-2.5-2.5l8.739-8.739a.25.25,0,0,0,0-.354L10.934,3.084a1.768,1.768,0,0,1,2.5-2.5l9.541,9.541A2.643,2.643,0,0,1,23.75,12Z"})]})});const A=({onInterlocutorChanged:s})=>{const{userId:a,interlocutorId:o}=j(),n=b(),r=k(),{data:t}=L({userId:a,interlocutorId:o}),i=l=>{const u=t==null?void 0:t.next;u&&(n(`/user/${a}/dialog/${u.humanId}`,{replace:!0}),s==null||s(l),r(M.updateViewedDialog({dialogId:u.dialog.id,updated:u.dialog.updated})))};return e.jsx(w,{"aria-label":"Previous dialog",icon:e.jsx(_,{}),isDisabled:!(t!=null&&t.next),onClick:i})},C=({onInterlocutorChanged:s})=>{const{userId:a,interlocutorId:o}=j(),n=b(),r=k(),{data:t}=L({userId:a,interlocutorId:o}),i=l=>{const u=t==null?void 0:t.prev;u&&(n(`/user/${a}/dialog/${u.humanId}`,{replace:!0}),s==null||s(l),r(M.updateViewedDialog({dialogId:u.dialog.id,updated:u.dialog.updated})))};return e.jsx(w,{"aria-label":"Previous dialog",icon:e.jsx(T,{}),isDisabled:!(t!=null&&t.prev),onClick:i})},z=({children:s})=>e.jsx(x,{above:"md",children:s}),J=h.memo(z),K=({galleryOpen:s=!1,handleFilterPhotos:a,photosCount:o,onInterlocutorChanged:n,loadingPhotos:r,children:t})=>{const{userId:i,interlocutorId:l}=j(),u=b(),{data:c,isLoading:p}=V({userId:i,interlocutorId:l}),m=h.useCallback(()=>u(`/user/${c==null?void 0:c.id}`,{replace:!0}),[u,c==null?void 0:c.id]),d=()=>u(`/user/${i}`);return e.jsxs(N,{children:[e.jsx(O,{user:c,loading:p,leftSlot:e.jsx(x,{above:"md",children:e.jsx(C,{onInterlocutorChanged:n})}),rightSlot:e.jsx(x,{above:"md",children:e.jsx(A,{onInterlocutorChanged:n})}),onClick:m,childrenWrapper:J,children:e.jsxs(I,{justify:"center",children:[e.jsx(f,{onClick:d,children:"Back"}),e.jsx(S,{pressed:s,onClick:a,photosCount:o,loading:r})]})}),t]})},X=({showOnlyPhotos:s,handleFilterPhotos:a,photosCount:o,onInterlocutorChanged:n,loadingPhotos:r})=>{const{userId:t}=j(),i=b(),l=()=>i(`/user/${t}`);return e.jsxs(H,{display:"flex",justifyContent:"space-between",pos:"fixed",bottom:"0",left:"0",right:"0",gap:"3",py:"7",zIndex:"1",bg:"#fff",children:[e.jsx(C,{onInterlocutorChanged:n}),e.jsxs(D,{direction:"row",children:[e.jsx(f,{onClick:l,children:"Back"}),e.jsx(S,{pressed:s,onClick:a,photosCount:o,loading:r})]}),e.jsx(A,{onInterlocutorChanged:n})]})},oe=()=>{const{userId:s,interlocutorId:a}=j(),{photos:o,photosCount:n,filterByUserId:r,setFilterByUserId:t,setMessages:i}=R(),[l,u]=h.useState(!1),[c,p]=h.useState(!0),m=()=>u(()=>!l),d=()=>{p(!0),i([])},v=h.useCallback(B=>{i(B),p(!1)},[i]),g=h.useCallback(()=>p(!0),[]);return e.jsx(e.Fragment,{children:e.jsx(E,{header:e.jsx(K,{galleryOpen:l,handleFilterPhotos:m,photosCount:n,onInterlocutorChanged:d,loadingPhotos:c,children:l&&e.jsxs(I,{justify:"center",mt:3,children:[e.jsx(f,{colorScheme:"blue",variant:r===a?"solid":"outline",onClick:()=>{if(r===a)return t(null);a&&t(a)},children:"Interlocutor"}),e.jsx(f,{colorScheme:"blue",variant:r===s?"solid":"outline",onClick:()=>{if(r===s)return t(null);s&&t(s)},children:"User"})]})}),footer:e.jsx(x,{below:"md",children:e.jsx(X,{showOnlyPhotos:l,handleFilterPhotos:m,photosCount:n,onInterlocutorChanged:d,loadingPhotos:c})}),children:e.jsx(F,{onMessageListLoadEnded:v,onMessageListLoadStarted:g,galleryPhotos:o,galleryOpen:l})})})};export{oe as default};
